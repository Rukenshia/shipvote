kind: pipeline
name: backend

workspace:
  base: /root

steps:
- name: install
  image: elixir:latest
  environment:
    DEV_SECRET_EXS:
      from_secret: dev.secret.exs
  commands:
  - cd backend
  - echo "${DEV_SECRET_EXS}" > config/dev.secret.exs
  - mix local.rebar --force
  - mix local.hex --force
  - mix deps.get

- name: test
  image: elixir:latest
  commands:
  - cd backend
  - mix test

---
kind: pipeline
name: frontend

steps:
- name: build
  image: node
  commands:
  - cd frontend/shipvote-frontend
  - npm install
  - npm run build